"use strict";angular.module("sbAdminApp").controller("MainCtrl",function($scope,$position,NgTableParams,$riffle,$http){function sinAndCos(){for(var sin=[],sin2=[],cos=[],i=0;100>i;i++)sin.push({x:i,y:Math.sin(i/10)}),sin2.push({x:i,y:i%10==5?null:.25*Math.sin(i/10)+.5}),cos.push({x:i,y:.5*Math.cos(i/10+2)+Math.random()/10});return[{values:sin,key:"Sine Wave",color:"#ff7f0e"},{values:cos,key:"Cosine Wave",color:"#2ca02c"}]}$scope.parser={};var set_up_scope=function(parser){for(var key in parser.type)for(var i=0;i<parser.type[key].byte_length;i++)$scope[parser.type[key].label[i]]=null;console.log("Updated Scope variables")};$http.get("../../parser.json").success(function(data){$scope.parser=data,console.log("Parser read successfully"),set_up_scope($scope.parser)}),$scope.custom=!1,$scope.raw=!1,$scope.template=!1,$scope.msgType=0,$scope.msgDataSize=0,$scope.progress=[],$scope.items=[{id:1,label:"Heartbeat",message:"5C0#10001",endpoint:"hb"},{id:2,label:"Start",message:"0x",endpoint:"cmd"},{id:3,label:"Stop",message:"0x",endpoint:"cmd"}],$scope.modules=[{name:"NONE",mask:"FFF"},{name:"VNM",mask:"001"},{name:"VSM",mask:"002"},{name:"BCM",mask:"004"},{name:"MCM",mask:"008"},{name:"WCM",mask:"010"},{name:"BMS",mask:"020"},{name:"ALL",mask:"400"}],$scope.msgSizes=[{name:"0",data:""},{name:"1",data:"FF"},{name:"2",data:"FFFF"},{name:"3",data:"FFFFFF"},{name:"4",data:"FFFFFFFF"},{name:"5",data:"FFFFFFFFFF"},{name:"6",data:"FFFFFFFFFFFF"},{name:"7",data:"FFFFFFFFFFFFFF"},{name:"8",data:"FFFFFFFFFFFFFFFF"}],$scope.msgTypes=[{name:"0",data:""},{name:"1",data:"FF"},{name:"2",data:"FFFF"},{name:"3",data:"FFFFFF"},{name:"4",data:"FFFFFFFF"},{name:"5",data:"FFFFFFFFFF"},{name:"6",data:"FFFFFFFFFFFF"},{name:"7",data:"FFFFFFFFFFFFFF"},{name:"8",data:"FFFFFFFFFFFFFFFF"}],$scope.selectedModule=$scope.modules[0],$scope.selectedSize=$scope.msgSizes[0],$scope.customMessage="0xFFFFFFFF",$scope.sendMessage="0xFFFFFFFF",$scope.heartbeat="0x5C010001",$scope.custMsgType="Template",$scope.changeModule=function(){$scope.customMessage="0x"+$scope.selectedModule.mask+"FFFFF"},$scope.changeSize=function(){$scope.customMessage="0x"+$scope.selectedModule.mask+$scope.selectedSize.name+$scope.selectedSize.data},$scope.toggleCustMsgType=function(type){$scope.custMsgType=type},$scope.sentMessages=[],$scope.messages=[],$scope.sortType="module",$scope.sortReverse=!1,$scope.messageSearch="",$scope.data=sinAndCos(),$scope.title="My gauge",$scope.titleFontColor="blue",$scope.value=1234.358,$scope.valueFontColor="red",$scope.min=0,$scope.max=1337,$scope.valueMinFontSize=void 0,$scope.titleMinFontSize=void 0,$scope.labelMinFontSize=void 0,$scope.minLabelMinFontSize=void 0,$scope.maxLabelMinFontSize=void 0,$scope.hideValue=!1,$scope.hideMinMax=!1,$scope.hideInnerShadow=!1,$scope.width=void 0,$scope.height=void 0,$scope.relativeGaugeSize=void 0,$scope.gaugeWidthScale=.5,$scope.gaugeColor="grey",$scope.showInnerShadow=!0,$scope.shadowOpacity=.5,$scope.shadowSize=3,$scope.shadowVerticalOffset=10,$scope.levelColors=["#00FFF2","#668C54","#FFAF2E","#FF2EF1"],$scope.customSectors=[{color:"#ff0000",lo:0,hi:750},{color:"#00ff00",lo:750,hi:1e3},{color:"#0000ff",lo:1e3,hi:1337}],$scope.noGradient=!1,$scope.label="Green label",$scope.labelFontColor="green",$scope.startAnimationTime=0,$scope.startAnimationType=void 0,$scope.refreshAnimationTime=void 0,$scope.refreshAnimationType=void 0,$scope.donut=void 0,$scope.donutAngle=90,$scope.counter=!0,$scope.decimals=2,$scope.symbol="X",$scope.formatNumber=!0,$scope.humanFriendly=!0,$scope.humanFriendlyDecimal=!0,$scope.textRenderer=function(value){return value},$scope.get_progress=function(){$scope.stacked=[];for(var types=["success","info","warning","danger"],i=0,n=Math.floor(4*Math.random()+1);n>i;i++){var index=Math.floor(4*Math.random());$scope.progress.push({value:Math.floor(30*Math.random()+1),type:types[index]})}},$scope.get_progress(),$scope.sendMessage=function(message,endpoint,domain){$riffle.publish(endpoint,message)},$riffle.subscribe("can",function(data){console.log(data);for(var formattted_messages=[],a=0;a<data.length;a++)formattted_messages.push({timestamp:new Date(1e3*parseFloat(data[a][0])),sid:data[a][1],type:data[a][2],data:data[a][3]});$scope.messages=formattted_messages}),$scope.tableParams=new NgTableParams({},{dataset:$scope.messages}),$scope.guageOptions={lines:10,angle:0,lineWidth:.2,pointer:{length:1,strokeWidth:.035,color:"#000000"},staticZones:[{strokeStyle:"#F03E3E",min:0,max:130},{strokeStyle:"#FFDD00",min:130,max:170},{strokeStyle:"#30B32D",min:170,max:190},{strokeStyle:"#FFDD00",min:190,max:230},{strokeStyle:"#F03E3E",min:230,max:360}],limitMax:!0,generateGradient:!0,maxValue:360},$scope.roll=180,$scope.pitch=180,$scope.yaw=180,$scope.options={chart:{type:"lineChart",height:450,margin:{top:20,right:20,bottom:40,left:55},x:function(d){return d.x},y:function(d){return d.y},useInteractiveGuideline:!0,dispatch:{stateChange:function(e){console.log("stateChange")},changeState:function(e){console.log("changeState")},tooltipShow:function(e){console.log("tooltipShow")},tooltipHide:function(e){console.log("tooltipHide")}},xAxis:{axisLabel:"Time (ms)"},yAxis:{axisLabel:"Voltage (v)",tickFormat:function(d){return d3.format(".02f")(d)},axisLabelDistance:-10},callback:function(chart){console.log("!!! lineChart callback !!!")}},title:{enable:!0,text:"Velocity and Acceleration"},subtitle:{enable:!0,text:"Velocity and Acceleration",css:{"text-align":"center",margin:"10px 13px 0px 7px"}},caption:{enable:!1,text:"Velocity and Accelleration of the BadgerLoop Pod",css:{"text-align":"justify",margin:"10px 13px 0px 7px"}}}});