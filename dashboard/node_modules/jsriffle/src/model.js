var riffle = require('./riffle');

riffle.setFabric('wss://node.exis.io:8000/ws');

var backend = riffle.Domain('xs.demo.nick2.newapp.Storage');
backend.setToken('SvDiatU2e36XVBufS-C2ZDmqoUnHz1hk3ffIhayVFqN7zTKVvA9M8PALQBBHsm31nsGue3Vu9tip3JmV596NRaJAaEvyQZy6QPH3UC2h43xjGdn7UE9nsHanItfjJ1w6lfYBbZCUs2PSgRSqFHkA2lbwFwPM93KHcknr-BC3vxU_');

backend.onJoin = function(){

  var storage = riffle.xsStorage(backend);
  var carCollection = storage.xsCollection('cars');
  var boatCollection = storage.xsCollection('boats');

  backend.register('getRedCars', function(){

    return carCollection.find({color: 'red'});;

  }).then(success, error);

  backend.register('addBoats', function(boats){
    return boatCollection.insert_many(boats);
  }).then(success, error);

  function success(res){
    console.log('successful register');
  }

  function error(ret){
    console.log(ret);
  }

};

backend.join();
