var riffle = require('../index.js');
var fs = require('fs');
var mimetype = require('mimetype');

//riffle.setFabric('wss://node.exis.io:8000/ws');
riffle.setFabricLocal();
riffle.setRegistrar('http://localhost:8880');
riffle.setLogLevelDebug();

var app = riffle.Domain('xs.demo.nick.newapp.person');
var filestorage = riffle.xsFileStorage(app);
//nick2app.setToken('OKW3h1Z6mF0mLklcEdXkoSF.1hyP6fIY50sPlzNf27qR6FlOM1o2uVT5pJRLfrEX01XpU4BW0DUA1ee98plyrm2XQOIHHF.gaRKIGgxES123C-ygI3lYtL5f.4Q-7c48AdLjT.urogsa9pD6Ngjn7Kp1BOk8JKU-nwykOfoQhy0_');
app.setToken('bMcukBMNfcD2YJpMWxROKi2r0cACvMLEnTrFj7G-sl-LufQmypWyXz3DWTZI0uqu.t.JsfEHNl8GKShSOC2472en7.XmcJ0Zjkx4bUcs9bXvn2pc8U9FOiTSZ9FQxGKMqQtTu3l6JaA.jO-.ZFTb9bs6UhK29PL2rH6lUvWJqwA_');

app.onJoin = function(){

  //var file = fs.readFileSync('./client.js');
  //var mime = mimetype.lookup('./client.js');
  //console.log(mime);

  var str = riffle.xsFileStorage(app);
  str.uploadUserFile({name: 'client.js', path: './client.js'}).then(success, error);

  function success(res){
    console.log(res);
  }

  function error(ret){
    console.log('ERROR: ', ret);
  }
};

app.join();
